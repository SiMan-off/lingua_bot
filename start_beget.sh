#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ ะฑะพัะฐ ะฝะฐ Beget
# ะะพะผะตััะธัะต ััะพั ัะฐะนะป ะฒ ะบะพัะตะฝั ะฟัะพะตะบัะฐ ะฝะฐ ัะตัะฒะตัะต

# ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd ~/lingua_bot

# ะะบัะธะฒะธััะตะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต
source venv/bin/activate

# ะัะพะฒะตััะตะผ ัััะตััะฒะพะฒะฐะฝะธะต ะฟะฐะฟะบะธ ะดะฐะฝะฝัั
if [ ! -d "data" ]; then
    mkdir data
    echo "ะกะพะทะดะฐะฝะฐ ะฟะฐะฟะบะฐ data"
fi

# ะัะพะฒะตััะตะผ ัััะตััะฒะพะฒะฐะฝะธะต ะฟะฐะฟะบะธ ะปะพะณะพะฒ
if [ ! -d "logs" ]; then
    mkdir logs
    echo "ะกะพะทะดะฐะฝะฐ ะฟะฐะฟะบะฐ logs"
fi

# ะัะพะฒะตััะตะผ ัััะตััะฒะพะฒะฐะฝะธะต .env ัะฐะนะปะฐ
if [ ! -f ".env" ]; then
    echo "ะะจะะะะ: ะคะฐะนะป .env ะฝะต ะฝะฐะนะดะตะฝ!"
    echo "ะกะบะพะฟะธััะนัะต .env.beget ะฒ .env ะธ ะทะฐะฟะพะปะฝะธัะต ะฟะตัะตะผะตะฝะฝัะต"
    exit 1
fi

# ะฃะฑะธะฒะฐะตะผ ะฟัะตะดัะดััะธะน ะฟัะพัะตัั ะตัะปะธ ะพะฝ ะทะฐะฟััะตะฝ
pkill -f "python.*main"
pkill -f "python3.*main"

# ะะตะฑะพะปััะฐั ะฟะฐัะทะฐ ะฟะพัะปะต ะพััะฐะฝะพะฒะบะธ
sleep 2

# ะะฐะฟััะบะฐะตะผ ัะฐะฑะพััั ะฒะตััะธั ะฑะพัะฐ ะฒ ัะพะฝะต
nohup python3 main_fixed_middleware.py > logs/bot.log 2>&1 &

# ะะพะปััะฐะตะผ PID ะฟัะพัะตััะฐ
BOT_PID=$!
echo "ะะพั ะทะฐะฟััะตะฝ ั PID: $BOT_PID"
echo $BOT_PID > bot.pid

echo "โ ะะพั PolyglotAI44 ะทะฐะฟััะตะฝ ััะฟะตัะฝะพ!"
echo "๐ ะะพะณะธ: tail -f logs/bot.log"
echo "๐ ะััะฐะฝะพะฒะบะฐ: ./stop_beget.sh"